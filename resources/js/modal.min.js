/*!
 * Scripts for admin modal windows.
 * @since 1.4.0-beta_snap-03
 *
 * @package ReallySimpleCMS
 */
jQuery(document).ready($=>{'use strict';let clicked_button=null;$('.modal-launch').on('click',function(){clicked_button=this;$('body').addClass('modal-open');$('.modal').fadeIn(100);$('.modal').addClass('in');$('#media-type').text($(this).data('type'));$('.media-wrap').load($('.tabber #media.tab').children().data('href')+'?media_type='+$('#media-type').text());if($(this).data('insert')===!0){$('#media-select').data('insert',!0)}});$('#modal-close').on('click',function(){modalClose()});$('.delete-item').on('click',function(e){e.preventDefault();$('.delete-wrap h2 span').text($(this).data('item'));$('#confirm-delete').attr('href',$(this).attr('href'))});$('.modal-header .tabber .tab').on('click',function(){if(!$(this).hasClass('active')){$('.modal-header .tabber .tab').toggleClass('active');$('.modal-body .tab').toggleClass('active');if($('#upload').hasClass('active')){$('.upload-result').empty();$('#media-upload').trigger('reset');$('#media-select').prop('disabled',!0)}else if($('#media').hasClass('active')){$('.media-wrap').empty();$('.media-wrap').load($(this).children().data('href')+'?media_type='+$('#media-type').text());$('.media-details .field').empty();$('#media-select').prop('disabled',!0)}}});$('#media-upload').on('submit',function(e){e.preventDefault();$.ajax({contentType:!1,data:new FormData(this),method:'POST',processData:!1,success:result=>{$('.upload-result').html(result);if(result.indexOf('success')!==-1){$('#media-select').prop('disabled',!1)}},url:$(this).attr('action')})});$(document).on('click','.media-item',function(){if(!$(this).hasClass('selected')){$('.media-item').removeClass('selected');$(this).addClass('selected');let fields=$(this).find('.hidden');let field='';$(fields).each(function(){field=$(this).data('field');$('.media-details .'+field).html($(this).html())});$('#media-select').prop('disabled',!1)}else{$(this).removeClass('selected');$('.media-details .field').empty();$('#media-select').prop('disabled',!0)}});$('#media-select').on('click',function(){let data={id:0,title:'',filepath:'',mime_type:'',alt_text:'',width:0};if($('#upload').hasClass('active')){if($('.upload-result .hidden[data-field="id"]').length&&$('.upload-result .hidden[data-field="filepath"]').length){data.id=$('.upload-result .hidden[data-field="id"]').text();data.title=$('.upload-result .hidden[data-field="title"]').text();data.filepath=$('.upload-result .hidden[data-field="filepath"]').text();data.mime_type=$('.upload-result .hidden[data-field="mime_type"]').text();data.width=$('.upload-result .hidden[data-field="width"]').text();if($(this).data('insert')===!0){insertMedia($('.content .textarea-input[name="content"]'),data)}else{$(clicked_button).siblings('input[data-field="id"]').val(data.id);$(clicked_button).siblings('.image-wrap').children('img[data-field="thumb"]').attr('src',data.filepath)}}}else if($('#media').hasClass('active')){if($('.media-item').hasClass('selected')){data.id=$('.media-item.selected .hidden[data-field="id"]').text();data.title=$('.media-item.selected .hidden[data-field="title"]').text();data.filepath=$('.media-item.selected .hidden[data-field="filepath"] a').attr('href');data.mime_type=$('.media-item.selected .hidden[data-field="mime_type"]').text();data.alt_text=$('.media-item.selected .hidden[data-field="alt_text"]').text();data.width=$('.media-item.selected .hidden[data-field="width"]').text();if($(this).data('insert')===!0){insertMedia($('.content .textarea-input[name="content"]'),data)}else{$(clicked_button).siblings('input[data-field="id"]').val(data.id);$(clicked_button).siblings('.image-wrap').children('img[data-field="thumb"]').attr('src',data.filepath)}}else{$(clicked_button).siblings('input[data-field="id"]').val(0);$(clicked_button).siblings('.image-wrap').children('img[data-field="thumb"]').attr('src','//:0')}}
if($(clicked_button).siblings('.image-wrap').children('img[data-field="thumb"]').attr('src')!=='//:0'&&$(clicked_button).siblings('.image-wrap').children('img[data-field="thumb"]').attr('src')!==''){$(clicked_button).siblings('.image-wrap').children('img[data-field="thumb"]').css({maxWidth:'none'});$(clicked_button).siblings('.image-wrap').addClass('visible');$(clicked_button).siblings('.image-wrap').children('img[data-field="thumb"]').removeClass('greyout');$(clicked_button).siblings('.image-wrap').width(data.width);$(clicked_button).siblings('.image-wrap').children('img[data-field="thumb"]').css({maxWidth:'100%'})}else{$(clicked_button).siblings('.image-wrap').removeClass('visible')}
modalClose()});function insertMedia(container,data){let text=$(container).val();let content={selection_start:$(container).prop('selectionStart'),selection_end:$(container).prop('selectionEnd'),text_before:'',text_after:''};content.text_before=text.substring(0,content.selection_start);content.text_after=text.substring(content.selection_end,text.length);let media='';if(data.mime_type.indexOf('image')!==-1){media='<img src="'+data.filepath+'" alt="'+(data.hasOwnProperty('alt_text')?data.alt_text:'')+'">'}else if(data.mime_type.indexOf('audio')!==-1){media='<audio src="'+data.filepath+'"></audio>'}else if(data.mime_type.indexOf('video')!==-1){media='<video src="'+data.filepath+'"></video>'}else{media='<a href="'+data.filepath+'">'+data.title+'</a>'}
$(container).val(content.text_before+media+content.text_after)}
function modalClose(){$('body').removeClass('modal-open');$('.modal').fadeOut(500);$('.modal').removeClass('in');if($('.modal').attr('id')==='modal-upload'){$('.upload-result').empty();$('#media-upload').trigger('reset');$('.media-wrap').empty();$('.media-details .field').empty();$('#media-select').prop('disabled',!0)}
$('#media-select').data('insert',!1)}})