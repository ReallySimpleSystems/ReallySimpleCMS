/*!
 * Scripts for the front end of the CMS.
 * @since 2.2.1-alpha
 *
 * @package ReallySimpleCMS
 */
jQuery(document).ready($=>{'use strict';$(window).on('scroll',function(){if($(window).scrollTop()>250)
$('#scroll-top').addClass('visible');else $('#scroll-top').removeClass('visible')});$('#scroll-top').on('click',function(){$('html, body').animate({scrollTop:0},750)});let ajax_dir='/includes/ajax';let feed_start=10;let feed_count=10;$('body').on('click','.comment .actions .reply',function(e){e.preventDefault();let reply_to=$(this).children().data('replyto');$('.comments #reply-to').text('Replying to #'+reply_to+':');$('.comments #comments-reply .textarea-input').show();$('.comments #comments-reply .submit-comment').show();$('.comments #comments-reply p').remove();$('html, body').animate({scrollTop:$('.comments').offset().top},0);$('.comments #comments-reply input[name="replyto"]').val(reply_to)});$('body').on('input','.comments .textarea-input',function(){if($(this).val().length>0){$(this).siblings('.submit-comment').prop('disabled',!1);$(this).siblings('.update-comment').prop('disabled',!1)}else{$(this).siblings('.submit-comment').prop('disabled',!0);$(this).siblings('.update-comment').prop('disabled',!0)}});$('body').on('click','.comments .submit-comment',function(){let comments=$('.comments .count').data('comments');let data={'data_submit':'reply','post':$(this).siblings('input[name="post"]').val(),'content':$(this).siblings('.textarea-input').val(),'replyto':$(this).siblings('input[name="replyto"]').val()};$.ajax({data:data,method:'POST',success:result=>{$(this).parent().prepend(result);$(this).siblings('.textarea-input').val('');$(this).siblings('.textarea-input').hide();$(this).hide();$('.comments .count').data('comments',comments+1);feed_start++;refreshFeed()},url:ajax_dir+'/ajax.php'})});$('body').on('click','.comment .actions .edit a',function(e){e.preventDefault();let content=$(this).parents().siblings('.content');$(content).hide();$(content).after('<div class="textarea-wrap">'+'<input type="hidden" name="id" value="'+$(this).data('id')+'">'+'<textarea class="textarea-input" cols="60" rows="8">'+$(content).text().trim()+'</textarea>'+'<button type="button" class="cancel button">Cancel</button>'+'<button type="submit" class="update-comment button">Submit</button></div>')});$('body').on('click','.comments .cancel',function(){let content=$(this).parent().siblings('.content');$(content).show();$(this).parent().remove()});$('body').on('click','.comments .update-comment',function(){let data={'data_submit':'edit','id':$(this).siblings('input[name="id"]').val(),'content':$(this).siblings('.textarea-input').val().trim()};$.ajax({data:data,method:'POST',success:result=>{refreshFeed()},url:ajax_dir+'/ajax.php'})});$('body').on('click','.comment .actions .delete a',function(e){e.preventDefault();let comments=$('.comments .count').data('comments');let data={'data_submit':'delete','id':$(this).data('id')};$.ajax({data:data,method:'POST',success:result=>{$('.comments .count').data('comments',comments-1);feed_start--;refreshFeed()},url:ajax_dir+'/ajax.php'})});$('body').on('click','.comment .actions .upvote a',function(e){e.preventDefault();let data={'data_submit':'vote','id':$(this).data('id'),'vote':$(this).data('vote'),'type':'upvotes'};submitVote(data,$(this));let downvote=$(this).parent().siblings('.downvote').children('a');if($(this).data('vote')){$(this).data('vote',0);$(downvote).addClass('active')}else{$(this).data('vote',1);$(this).addClass('active');$(downvote).removeClass('active');if($(downvote).data('vote')){submitVote({'data_submit':'vote','id':$(downvote).data('id'),'vote':$(downvote).data('vote'),'type':'downvotes'},downvote);$(downvote).data('vote',0)}}});$('body').on('click','.comment .actions .downvote a',function(e){e.preventDefault();let data={'data_submit':'vote','id':$(this).data('id'),'vote':$(this).data('vote'),'type':'downvotes'};submitVote(data,$(this));let upvote=$(this).parent().siblings('.upvote').children('a');if($(this).data('vote')){$(this).data('vote',0);$(upvote).addClass('active')}else{$(this).data('vote',1);$(this).addClass('active');$(upvote).removeClass('active');if($(upvote).data('vote')){submitVote({'data_submit':'vote','id':$(upvote).data('id'),'vote':$(upvote).data('vote'),'type':'upvotes'},upvote);$(upvote).data('vote',0)}}});function submitVote(data,elem){$.ajax({data:data,method:'POST',success:result=>{$(elem).siblings('span').text(result)},url:ajax_dir+'/ajax.php'})}
$('body').on('click','.comments .load.button',function(){let data={'data_submit':'load','post_slug':$('body').attr('class').split(' ')[1],'start':feed_start,'count':feed_count};$.ajax({data:data,method:'POST',success:result=>{$('.comments .count').remove();$('.comments .load.button').remove();$(result).appendTo('.comments-wrap');feed_start+=10},url:ajax_dir+'/ajax.php'})});function refreshFeed(){let comments=$('.comments .count').data('comments');$('.comments-wrap').empty();let data={'data_submit':'refresh','post_slug':$('body').attr('class').split(' ')[1],'start':0,'count':comments};$.ajax({data:data,method:'POST',success:result=>{$(result).appendTo('.comments-wrap')},url:ajax_dir+'/ajax.php'})}
if($('.comments').length){let comment_count=0;setInterval(function(){let comments=$('.comments .count').data('comments');let data={'data_submit':'checkupdates','post_slug':$('body').attr('class').split(' ')[1]};$.ajax({data:data,method:'POST',success:result=>{if(comment_count===0)comment_count=result;if(result!==comment_count){if(result<comment_count){$('.comments .count').data('comments',comments-1);feed_start--}else{$('.comments .count').data('comments',comments+1);feed_start++}
refreshFeed();comment_count=result}},url:ajax_dir+'/ajax.php'})},1000*15)}
let field_height=$('.password-field input').height();let button_height=$('#password-toggle').height();if(button_height<field_height)
$('#password-toggle').css({height:field_height+12+'px'});$('#password-toggle').on('click',function(){if($(this).data('visibility')==='hidden'){$('.password-field input').attr('type','text');$(this).data('visibility','visible');$(this).attr('title','Hide password');$(this).children().removeClass('fa-eye').addClass('fa-eye-slash')}else if($(this).data('visibility')==='visible'){$('.password-field input').attr('type','password');$(this).data('visibility','hidden');$(this).attr('title','Show password');$(this).children().removeClass('fa-eye-slash').addClass('fa-eye')}})})